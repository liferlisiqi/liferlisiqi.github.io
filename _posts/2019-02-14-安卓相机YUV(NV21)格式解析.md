---
layout:     post
title:      安卓相机YUV(NV21)格式解析        
date:       2019-02-14   
author:     lsq    
header-img: img/post-bg-coffee.jpeg
catalog: true
tags:
    - ANDROID
---

我们在开发安卓相机相关应用的时候，最基本的操作是在屏幕上实时预览相机捕获的图像。但更多时候需要对捕获到的图像或者视频进行处理，例如人脸检测，图像增强等等。在处理图像时，不可避免地会遇到图像格式的问题，常见的格式有：RGB，YUV和灰度图等。

安卓开发中，我们处理的实时图像数据来自相机的回调函数onPreviewFrame(final byte[] bytes, final Camera camera)。其中 `bytes` 存的就是当前帧的数据，但是不能直接对其进行处理，需要先进行一些格式转换。 `bytes` 的默认格式是 YUV(NV21) ，接下来就从该格式入手，介绍安卓相机相关的图像格式问题。 

## 1 YUV格式  

YUV，分为三个分量，`Y`表示明亮度（Luminance或Luma），也就是灰度值；而`U`和`V` 表示的则是色度（Chrominance或Chroma），作用是描述影像色彩及饱和度，用于指定像素的颜色。它将亮度信息（Y）与色彩信息（UV）分离，没有UV信息一样可以显示完整的图像，只不过是黑白的，这样的设计很好地解决了彩色电视机与黑白电视的兼容问题。并且，YUV不像RGB那样要求三个独立的视频信号同时传输，所以用YUV方式传送占用极少的频宽。

YUV的存储格式其实与其采样的方式密切相关，主流的采样方式有三种，YUV4:4:4，YUV4:2:2，YUV4:2:0。下面用三个图来直观地表示采样方式，以黑点表示采样该像素点的Y分量，以空心圆圈表示采用该像素点的UV分量。YUV 4:4:4采样:每一个Y对应一组UV分量;YUV 4:2:2采样:每两个Y共用一组UV分量;YUV 4:2:0采样:每四个Y共用一组UV分量。

![](https://raw.githubusercontent.com/liferlisiqi/liferlisiqi.github.io/master/img/2019-02-14-YUV.jpg)  

YUV420采样方式得到数据的存储格式分为`YUV420P`和`YUV420SP`两种，其含义分别是planar和packed。对于`YUV420P(YU12和YV12)`，先连续存储所有像素点的Y，紧接着存储所有像素点的U和所有像素点的V。对于`YUV420SP(NV21和NV12)`，先连续存储所有像素点的Y，接着连续交叉存储每个像素点的U,V。举一个包含8个像素点的例子：

YU12: YYYYYYYY UU VV    =>YUV420P
YV12: YYYYYYYY VV UU    =>YUV420P
NV12: YYYYYYYY UVUV     =>YUV420SP
NV21: YYYYYYYY VUVU     =>YUV420SP



## 2 YUV420分量提取  



## 3 YUV420转换RGB



## Reference
[图文详解YUV420数据格式](https://www.cnblogs.com/azraelly/archive/2013/01/01/2841269.html)
[图解YU12、I420、YV12、NV12、NV21、YUV420P、YUV420SP、YUV422P、YUV444P的区别](https://blog.csdn.net/byhook/article/details/84037338)
[]()
[]()
[]()
[]()
